<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ひとりの冒険手順計算ツール</title>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
    }
    h2 {
      margin-top: 20px;
    }
    #description {
      margin-top: 10px;
      font-size: 14px;
    }
    #circle-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 30px auto;
    }
    .circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      margin: -30px;
      cursor: pointer;
      border: 2px solid #444;
      transition: background-color 0.3s;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-weight: bold;
      user-select: none;
    }
    .red    { background-color: red; }
    .blue   { background-color: blue; }
    .yellow { background-color: gold; }
    #output {
      margin-top: 20px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

<h2>ひとりの冒険手順計算ツール</h2>
<div id="description">
  円をタップすると赤(喜多)→青(リョウ)→黄(虹夏)→赤…の順に色が遷移します。
</div>

<div id="circle-container"></div>

<button onclick="runSolver()">実行</button>
<div id="output"></div>

<script>
  const colors = ['red', 'blue', 'yellow'];
  const circleStates = [0, 0, 0, 0, 0, 0];
  const container = document.getElementById('circle-container');
  const radius = 120;

  for (let i = 0; i < 6; i++) {
    const angle = (i / 6) * 2 * Math.PI - Math.PI / 3; // -60度スタート（右上）
    const x = radius * Math.cos(angle);
    const y = radius * Math.sin(angle);

    const c = document.createElement('div');
    c.className = 'circle red';
    c.dataset.index = i;
    c.style.transform = `translate(${x}px, ${y}px)`;

    const label = document.createElement('div');
    label.textContent = i + 1;
    c.appendChild(label);

    c.onclick = () => {
      circleStates[i] = (circleStates[i] + 1) % 3;
      c.className = 'circle ' + colors[circleStates[i]];
    };

    container.appendChild(c);
  }

  function mod3(n) {
    return ((n % 3) + 3) % 3;
  }

  function solvePresses(colors) {
    const product = (arr, r = [], res = []) => {
      if (r.length === arr.length) return res.push([...r]);
      for (let i = 0; i < 3; i++) {
        r.push(i);
        product(arr, r, res);
        r.pop();
      }
      return res;
    };

    const arrangements = product(new Array(6));
    let best = null, bestTotal = Infinity;

    for (const presses of arrangements) {
      let newColors = [...colors];
      for (let i = 0; i < 6; i++) {
        const t = presses[i];
        if (t) {
          newColors[(i + 5) % 6] = mod3(newColors[(i + 5) % 6] + t);
          newColors[(i + 1) % 6] = mod3(newColors[(i + 1) % 6] + t);
        }
      }

      const count = [0, 0, 0];
      for (let c of newColors) count[c]++;
      if (!count.includes(5)) continue;

      const seq = arrangeNonRepeating(presses);
      if (!seq) continue;

      const total = presses.reduce((a, b) => a + b, 0);
      if (total < bestTotal) {
        best = { presses, seq };
        bestTotal = total;
      }
    }
    return best;
  }

  function arrangeNonRepeating(presses) {
    const multiset = [];
    for (let i = 0; i < 6; i++) {
      for (let j = 0; j < presses[i]; j++) multiset.push(i);
    }
    const result = [];
    let prev = -1;
    while (multiset.length) {
      const candidates = multiset.filter(x => x !== prev);
      if (!candidates.length) return null;
      const chosen = candidates[0];
      result.push(chosen);
      multiset.splice(multiset.indexOf(chosen), 1);
      prev = chosen;
    }
    return result;
  }

  function runSolver() {
    const result = solvePresses(circleStates);
    const output = document.getElementById('output');
    if (!result) {
      output.textContent = "有効な押し順が見つかりませんでした。";
      return;
    }

    let msg = "--- 押す順番---\n";
    result.seq.forEach(i => {
      msg += `円${i + 1} を押す\n`;
    });

    output.textContent = msg;
  }
</script>

</body>
</html>
