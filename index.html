<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>色合わせパズル</title>
  <style>
    body { text-align: center; font-family: sans-serif; }
    .circle {
      width: 60px; height: 60px;
      border-radius: 50%;
      display: inline-block;
      margin: 10px;
      cursor: pointer;
      border: 2px solid #444;
    }
    .red    { background-color: red; }
    .blue   { background-color: blue; }
    .yellow { background-color: gold; }
    #output { margin-top: 20px; white-space: pre-wrap; }
  </style>
</head>
<body>

<h2>6つの円をクリックして色を設定してください</h2>
<div id="circles"></div>
<br>
<button onclick="runSolver()">実行</button>
<div id="output"></div>

<script>
  const colors = ['red', 'blue', 'yellow'];
  const colorNames = ['r', 'b', 'y'];
  const circleStates = [0, 0, 0, 0, 0, 0];

  const container = document.getElementById('circles');
  for (let i = 0; i < 6; i++) {
    const c = document.createElement('div');
    c.className = 'circle red';
    c.dataset.index = i;
    c.onclick = () => {
      circleStates[i] = (circleStates[i] + 1) % 3;
      c.className = 'circle ' + colors[circleStates[i]];
    };
    container.appendChild(c);
  }

  function mod3(n) { return ((n % 3) + 3) % 3; }

  function solvePresses(colors) {
    const product = (arr, r = [], res = []) => {
      if (r.length === arr.length) return res.push([...r]);
      for (let i = 0; i < 3; i++) {
        r.push(i);
        product(arr, r, res);
        r.pop();
      }
      return res;
    };

    const arrangements = product(new Array(6));
    let best = null, bestTotal = Infinity;

    for (const presses of arrangements) {
      let newColors = [...colors];
      for (let i = 0; i < 6; i++) {
        const t = presses[i];
        if (t) {
          newColors[(i + 5) % 6] = mod3(newColors[(i + 5) % 6] + t);
          newColors[(i + 1) % 6] = mod3(newColors[(i + 1) % 6] + t);
        }
      }

      const count = [0, 0, 0];
      for (let c of newColors) count[c]++;
      if (!count.includes(5)) continue;

      const seq = arrangeNonRepeating(presses);
      if (!seq) continue;

      const total = presses.reduce((a, b) => a + b, 0);
      if (total < bestTotal) {
        best = { presses, seq };
        bestTotal = total;
      }
    }
    return best;
  }

  function arrangeNonRepeating(presses) {
    const multiset = [];
    for (let i = 0; i < 6; i++) {
      for (let j = 0; j < presses[i]; j++) multiset.push(i);
    }
    const result = [];
    let prev = -1;
    while (multiset.length) {
      const candidates = multiset.filter(x => x !== prev);
      if (!candidates.length) return null;
      const chosen = candidates[0];
      result.push(chosen);
      multiset.splice(multiset.indexOf(chosen), 1);
      prev = chosen;
    }
    return result;
  }

  function runSolver() {
    const result = solvePresses(circleStates);
    const output = document.getElementById('output');
    if (!result) {
      output.textContent = "有効な押し順が見つかりませんでした。";
      return;
    }

    let msg = "--- 押す回数 ---\n";
    result.presses.forEach((p, i) => {
      if (p) msg += `点${i + 1} を${p}回押す\n`;
    });

    msg += "\n--- 押す順番（同じ点連続なし）---\n";
    result.seq.forEach(i => {
      msg += `点${i + 1} を押す\n`;
    });

    output.textContent = msg;
  }
</script>

</body>
</html>
