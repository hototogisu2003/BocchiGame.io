<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ひとりの冒険絵柄揃えツール</title>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    h2 {
      margin-top: 20px;
      font-size: 1.2em;
    }
    #description {
      margin-top: 10px;
      font-size: 0.9em;
      padding: 0 1em;
    }
    #circle-container {
      position: relative;
      width: 90vmin;
      height: 90vmin;
      max-width: 400px;
      max-height: 400px;
      margin: 30px auto 10px auto; 
    }
    .circle {
      width: 14vmin;
      height: 14vmin;
      max-width: 60px;
      max-height: 60px;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      border: 2px solid #444;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      color: white;
      font-size: 1em;
      transition: background-color 0.3s;
      user-select: none;
    }
    .red    { background-color: red; }
    .blue   { background-color: blue; }
    .yellow { background-color: gold; }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 1em;
    }
    #output {
      margin-top: 20px;
      white-space: pre-wrap;
      font-size: 1em;
      padding: 0 1em;
    }
  </style>
</head>
<body>

<h2>ひとりの冒険絵柄揃えツール</h2>
<div id="description">
  円をタップすると赤(喜多)→青(リョウ)→黄(虹夏)→赤…の順に色が遷移します。<br>初期状態の色を揃えたら実行ボタンを押してください。
</div>

<div id="circle-container"></div>

<button onclick="runSolver()">実行</button>
<div id="output"></div>

<script>
  const colors = ['red', 'blue', 'yellow'];
  const circleStates = [0, 0, 0, 0, 0, 0];
  const container = document.getElementById('circle-container');

  function placeCircles() {
    const rect = container.getBoundingClientRect();
    const radius = rect.width / 2.3;

    container.innerHTML = '';
    for (let i = 0; i < 6; i++) {
      const angle = (i / 6) * 2 * Math.PI - Math.PI / 3;
　    const compression = 0.85;  // 0.85 = 15%縦圧縮（好みに応じて変更）

      const x = 50 + (radius * Math.cos(angle) / rect.width) * 100;
      const y = 50 + (radius * Math.sin(angle) * compression / rect.height) * 100;

      const c = document.createElement('div');
      c.className = 'circle ' + colors[circleStates[i]];
      c.dataset.index = i;
      c.style.left = `${x}%`;
      c.style.top = `${y}%`;

      const label = document.createElement('div');
      label.textContent = i + 1;
      c.appendChild(label);

      c.onclick = () => {
        circleStates[i] = (circleStates[i] + 1) % 3;
        c.className = 'circle ' + colors[circleStates[i]];
      };

      container.appendChild(c);
    }
  }

  window.addEventListener('resize', placeCircles);
  window.addEventListener('load', placeCircles);

  function mod3(n) {
    return ((n % 3) + 3) % 3;
  }

  function solvePresses(colors) {
    const product = (arr, r = [], res = []) => {
      if (r.length === arr.length) return res.push([...r]);
      for (let i = 0; i < 3; i++) {
        r.push(i);
        product(arr, r, res);
        r.pop();
      }
      return res;
    };

    const arrangements = product(new Array(6));
    let best = null, bestTotal = Infinity;

    for (const presses of arrangements) {
      let newColors = [...colors];
      for (let i = 0; i < 6; i++) {
        const t = presses[i];
        if (t) {
          newColors[(i + 5) % 6] = mod3(newColors[(i + 5) % 6] + t);
          newColors[(i + 1) % 6] = mod3(newColors[(i + 1) % 6] + t);
        }
      }

      const count = [0, 0, 0];
      for (let c of newColors) count[c]++;
      if (!count.includes(5)) continue;

      const seq = arrangeNonRepeating(presses);
      if (!seq) continue;

      const total = presses.reduce((a, b) => a + b, 0);
      if (total < bestTotal) {
        best = { presses, seq };
        bestTotal = total;
      }
    }
    return best;
  }

  function arrangeNonRepeating(presses) {
    const multiset = [];
    for (let i = 0; i < 6; i++) {
      for (let j = 0; j < presses[i]; j++) multiset.push(i);
    }
    const result = [];
    let prev = -1;
    while (multiset.length) {
      const candidates = multiset.filter(x => x !== prev);
      if (!candidates.length) return null;
      const chosen = candidates[0];
      result.push(chosen);
      multiset.splice(multiset.indexOf(chosen), 1);
      prev = chosen;
    }
    return result;
  }

  function runSolver() {
    const result = solvePresses(circleStates);
    const output = document.getElementById('output');
    if (!result) {
      output.textContent = "有効な押し順が見つかりませんでした。";
      return;
    }

    let msg = "--- 押す順番---\n";
    msg += result.seq.map(i => `円${i + 1}`).join(" → ");
    output.textContent = msg;
  }
</script>

</body>
</html>
